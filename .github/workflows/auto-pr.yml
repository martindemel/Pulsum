name: Auto Create Pull Request

# Automatically creates a PR when you push a feature branch
# This enables CodeRabbit to review your changes

on:
  push:
    branches:
      - 'feature/**'
      - 'bugfix/**'
      - 'hotfix/**'
      - 'refactor/**'
      - 'chore/**'

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Check if PR already exists
        id: check-pr
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BRANCH_NAME="${GITHUB_REF#refs/heads/}"
          echo "branch=$BRANCH_NAME" >> $GITHUB_OUTPUT
          
          PR_EXISTS=$(gh pr list --head "$BRANCH_NAME" --json number --jq length)
          echo "pr_exists=$PR_EXISTS" >> $GITHUB_OUTPUT
      
      - name: Create Pull Request
        if: steps.check-pr.outputs.pr_exists == '0'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BRANCH_NAME="${{ steps.check-pr.outputs.branch }}"
          
          # Extract meaningful title from branch name
          # e.g., feature/add-user-auth -> Add user auth
          PR_TITLE=$(echo "$BRANCH_NAME" | sed 's/.*\///' | sed 's/-/ /g' | sed 's/\b\(.\)/\u\1/g')
          
          # Create PR body with useful information
          PR_BODY="## Changes
          
          This PR was automatically created from branch \`$BRANCH_NAME\`.
          
          ### ðŸ¤– Automated PR Creation
          
          CodeRabbit will review this PR automatically. Once approved, you can merge it manually or it will auto-merge if configured.
          
          ### âœ… Checklist
          
          - [ ] Code follows project style guidelines
          - [ ] Tests pass locally
          - [ ] Documentation updated if needed
          - [ ] No breaking changes
          
          ---
          *Auto-generated by GitHub Actions*"
          
          gh pr create \
            --title "[$BRANCH_NAME] $PR_TITLE" \
            --body "$PR_BODY" \
            --base main \
            --head "$BRANCH_NAME" \
            --label "auto-created"
      
      - name: Comment on PR creation
        if: steps.check-pr.outputs.pr_exists == '0'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "âœ… Pull Request created successfully!"
          echo "ðŸ¤– CodeRabbit will review it shortly"
          echo "ðŸ“Š Check the PR at: https://github.com/${{ github.repository }}/pulls"

