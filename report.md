# Pulsum Data Architecture Overview

## Introduction
Pulsum’s data architecture is planned as a privacy-forward ecosystem that unifies physiological signals, subjective reflections, and coaching knowledge into a cohesive wellness context. The system leans on platform-native services, compartmentalized Swift packages, and agent-driven orchestration so that data flows remain deterministic, transparent, and easy to audit. The sections that follow describe how acquisition, preprocessing, and exploratory analysis are intended to work together to support the product roadmap.

## Body
### Data Acquisition and Collection
Health signals originate from Apple HealthKit, where `HealthKitService` negotiates permissions, enables background delivery, and orchestrates observer-plus-anchored queries for metrics such as HRV, heart rate variants, respiratory rate, steps, and sleep stages. Each sample type is paired with `HealthKitAnchorStore`, which persists anchors on disk to resume incremental ingestion after app restarts while preserving `FileProtectionType.complete` safeguards. Voice journals and text reflections remain on device: `SpeechService` manages the audio session and streaming recognition, and the resulting transcripts flow through `SentimentAgent`, where `PIIRedactor` strips personally identifiable information before content is embedded and saved as `JournalEntry` rows alongside vector files stored under protected application directories. Coaching knowledge arrives through curated JSON bundles—imported by `LibraryImporter`—that calculate evidence scores, assign tags, and populate both Core Data `MicroMoment` entities and the sharded `VectorIndex` to keep retrieval fast and versioned. `DataStack` forms the backbone of storage, creating secure Application Support subdirectories, configuring the SQLite store, and preventing sensitive artifacts (including HealthKit anchors and embeddings) from syncing to iCloud. Architectural documentation ties these components to consent flows, safety escalation paths, and operational controls so that collection remains transparent to both users and auditors.

### Data Preprocessing and Feature Engineering
Preprocessing revolves around the asynchronous `DataAgent`, which subscribes to HealthKit updates, reconciles sample deletions, and reprocesses the relevant days whenever new data arrives. The agent composes a `DailySummary` for each calendar day, extracting medians and percentiles, calculating personalized sleep debt windows, and tagging sedentary intervals while recording quality flags that clarify any imputations. `BaselineMath` generates rolling median-and-MAD statistics so every raw metric can be normalized; the resulting z-scores are packaged into a `FeatureBundle` that also includes subjective stress, energy, and sleep-quality ratings plus journal sentiment scores stored in the corresponding `FeatureVector`. Metadata about imputation and contributions travels with each feature vector, ensuring downstream explainability. A lightweight `StateEstimator` updates wellbeing weights and bias terms through online learning, producing contribution vectors that identify the strongest signals behind each score. Coaching decisions leverage `RecRanker`, a logistic-ranking component that weighs wellbeing score, evidence strength, novelty, cooldown cadence, historical acceptance, and physiological z-scores to prioritize micro-moments. Historical feature vectors, recommendation events, and acceptance outcomes remain queryable via Core Data so that curated training, validation, and test batches can be assembled without breaching on-device privacy. Architectural notes catalog these features, define their units, and spell out transformation lineage, giving analysts a dependable contract for future work.

### Exploratory Data Analysis
Once data is staged, Pulsum’s design exposes multiple layers for exploration. `ScoreBreakdown` serves as an interpretability surface, combining z-scores, baselines, units, quality notes, and explanatory copy so descriptive statistics and visualizations can be produced with minimal derivation. Contribution vectors from `StateEstimator` and weight snapshots from `RecRanker` make it easy to trace how physiological or subjective metrics influence wellbeing predictions and coaching choices, opening the door to cohort comparisons or drift analyses. Vector embeddings stored by `VectorIndexManager` cover both journal content and micro-moments, enabling similarity searches, clustering, and topic modeling without re-ingesting raw text. Safety intent, classified by `SafetyAgent`, and consent toggles enforced by the agent orchestrator ensure that any exploratory exports or cloud-assisted analyses stay inside approved privacy boundaries. Roadmap artifacts outline how these analytical ingredients fold into milestone deliverables: curated feature tables with imputation flags, time-series of baselines, acceptance histories, sentiment summaries, and the regeneration scripts that allow reproducible insight packages.

## Conclusion
Pulsum’s planned data flow treats acquisition, preprocessing, and analysis as tightly coupled stages that honor user privacy while yielding rich, interpretable signals. HealthKit feeds, journaling pipelines, and curated knowledge bases funnel into a consistent feature layer, which in turn drives recommendation ranking and exploratory insight workflows. By codifying baselines, contribution tracking, and safety gates at every step, the architecture is poised to support future experimentation, regulatory reviews, and coaching enhancements without compromising user trust.
